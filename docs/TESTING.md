# ğŸ§ª æµ‹è¯•ç³»ç»Ÿè¯¦è§£

## æ¦‚è¿°

æœ¬é¡¹ç›®åŒ…å«å®Œæ•´çš„è‡ªåŠ¨åŒ–æµ‹è¯•ç³»ç»Ÿï¼Œé€šè¿‡å›¾åƒå¯¹æ¯”éªŒè¯æ¸²æŸ“å¼•æ“çš„ä¸€è‡´æ€§å’Œæ­£ç¡®æ€§ã€‚æµ‹è¯•ç³»ç»Ÿé‡‡ç”¨**çº¯å•å…ƒæµ‹è¯•**è®¾è®¡ï¼Œä¸ä¿®æ”¹ä»»ä½•ç°æœ‰æºç ï¼Œé€šè¿‡ç‹¬ç«‹è¿è¡Œæ¸²æŸ“ç¨‹åºæ¥å¯¹æ¯”å›¾ç‰‡å·®å¼‚ã€‚

## ğŸ¯ è®¾è®¡åŸåˆ™

### âœ… **éä¾µå…¥æ€§è®¾è®¡**
- ä¸ä¿®æ”¹ `src/` ç›®å½•ä¸‹çš„ä»»ä½•æ–‡ä»¶
- ä¸ä¿®æ”¹ç°æœ‰çš„æ¸²æŸ“å¼•æ“å’Œåè®®è§£æå™¨
- æµ‹è¯•ç¨‹åºå®Œå…¨ç‹¬ç«‹è¿è¡Œ

### âœ… **ç®€å•ç›´è§‚**
- å•ä¸€èŒè´£ï¼šä¸“æ³¨å›¾ç‰‡å¯¹æ¯”
- æ¸…æ™°çš„å·¥ä½œæµç¨‹å’Œè¾“å‡º
- æ˜“äºç†è§£ã€ç»´æŠ¤å’Œæ‰©å±•

## ğŸ”§ åŠŸèƒ½ç‰¹æ€§

### ğŸ“Š **å›¾åƒå¯¹æ¯”ç®—æ³•**
- **å“ˆå¸Œå€¼æ¯”è¾ƒ**: å¿«é€Ÿæ£€æµ‹å›¾ç‰‡æ˜¯å¦å®Œå…¨ç›¸åŒ
- **åƒç´ çº§å¯¹æ¯”**: ç²¾ç¡®è®¡ç®—å›¾ç‰‡å·®å¼‚ç™¾åˆ†æ¯”
- **å·®å¼‚å¯è§†åŒ–**: ç”Ÿæˆå·®å¼‚å›¾ç‰‡ï¼Œçº¢è‰²æ ‡è®°ä¸åŒåƒç´ ç‚¹

### ğŸ›ï¸ **æµ‹è¯•ç®¡ç†**
- **åŸºçº¿ç®¡ç†**: è‡ªåŠ¨åˆ›å»ºå’Œæ›´æ–°åŸºçº¿å›¾ç‰‡
- **å®¹å·®æ§åˆ¶**: å¯è°ƒèŠ‚çš„å·®å¼‚å®¹å¿åº¦ï¼ˆé»˜è®¤1%ï¼‰
- **æ‰¹é‡æ‰§è¡Œ**: ä¸€æ¬¡æ€§æµ‹è¯•æ‰€æœ‰é¡¹ç›®

### ğŸ”„ **ä¸€è‡´æ€§éªŒè¯**
- **å¤šæ¬¡æ¸²æŸ“**: åŒä¸€åè®®å¤šæ¬¡æ¸²æŸ“ï¼ŒéªŒè¯ç»“æœä¸€è‡´æ€§
- **éšæœºæ€§æ£€æµ‹**: è¯†åˆ«æ¸²æŸ“è¿‡ç¨‹ä¸­çš„ä¸ç¡®å®šå› ç´ 
- **ç¡®å®šæ€§ä¿è¯**: ç¡®ä¿æ¸²æŸ“ç»“æœæ˜¯å¯é‡ç°çš„

## ğŸ“ ç›®å½•ç»“æ„

```
tests/
â”œâ”€â”€ baseline/              # åŸºçº¿å›¾ç‰‡ç›®å½•
â”‚   â”œâ”€â”€ trip_baseline.png
â”‚   â”œâ”€â”€ food_baseline.png
â”‚   â”œâ”€â”€ single_line_baseline.png
â”‚   â””â”€â”€ ...
â”œâ”€â”€ diff/                  # å·®å¼‚å›¾ç‰‡ç›®å½•
â”œâ”€â”€ simple_image_test.cpp  # æµ‹è¯•ç¨‹åºæºç 
â””â”€â”€ README.md             # åŸå§‹æ–‡æ¡£

docs/
â””â”€â”€ TESTING.md            # æœ¬æ–‡æ¡£

run_simple_test.sh        # æµ‹è¯•è¿è¡Œè„šæœ¬
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶

```bash
# ä½¿ç”¨æµ‹è¯•è„šæœ¬ï¼ˆæ¨èï¼‰
./run_simple_test.sh

# æˆ–ç›´æ¥è¿è¡Œæµ‹è¯•ç¨‹åº
./build/simple_test run
```

**è¾“å‡ºç¤ºä¾‹**:
```
=== ç®€å•å›¾ç‰‡å¯¹æ¯”æµ‹è¯•å¼€å§‹ ===
è¿è¡Œæµ‹è¯•: trip
  âœ… å›¾ç‰‡å®Œå…¨ä¸€è‡´ (å“ˆå¸Œå€¼ç›¸åŒ)
è¿è¡Œæµ‹è¯•: food  
  âœ… å›¾ç‰‡åŸºæœ¬ä¸€è‡´ (å·®å¼‚: 0.3%)
...
æ€»æµ‹è¯•æ•°: 14, é€šè¿‡: 14, å¤±è´¥: 0
ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
```

### 2. æ›´æ–°åŸºçº¿å›¾ç‰‡

```bash
# æ›´æ–°æŒ‡å®šé¡¹ç›®çš„åŸºçº¿
./build/simple_test update trip
./build/simple_test update single_line

# æ›´æ–°æ‰€æœ‰åŸºçº¿ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
for project in trip food clothes single_line multi_line word_wrap auto_fit; do
    ./build/simple_test update $project
done
```

### 3. è°ƒæ•´å®¹å·®è®¾ç½®

```bash
# è®¾ç½®å®¹å·®ä¸º0.5%
./build/simple_test tolerance 0.005

# è®¾ç½®å®¹å·®ä¸º2%ï¼ˆé€‚åˆå¤§æ”¹åŠ¨ï¼‰
./build/simple_test tolerance 0.02
```

### 4. ä¸€è‡´æ€§æµ‹è¯•

```bash
# æµ‹è¯•æŒ‡å®šé¡¹ç›®çš„ä¸€è‡´æ€§ï¼ˆé»˜è®¤5æ¬¡ï¼‰
./build/simple_test consistency trip

# æŒ‡å®šè¿­ä»£æ¬¡æ•°
./build/simple_test consistency auto_fit 10

# æµ‹è¯•æ‰€æœ‰æ–‡æœ¬æ¨¡å¼
./build/simple_test consistency single_line 3
./build/simple_test consistency word_wrap 3
```

## ğŸ”„ æµ‹è¯•æµç¨‹

### é¦–æ¬¡è¿è¡Œ
1. ç³»ç»Ÿæ£€æµ‹åˆ°åŸºçº¿å›¾ç‰‡ä¸å­˜åœ¨
2. è‡ªåŠ¨è¿è¡Œæ¸²æŸ“ç¨‹åºç”Ÿæˆå½“å‰å›¾ç‰‡
3. å°†å½“å‰å›¾ç‰‡å¤åˆ¶ä¸ºåŸºçº¿å›¾ç‰‡
4. æ‰€æœ‰æµ‹è¯•æ ‡è®°ä¸ºé€šè¿‡

### åç»­è¿è¡Œ
1. è¿è¡Œæ¸²æŸ“ç¨‹åºç”Ÿæˆå½“å‰å›¾ç‰‡
2. è®¡ç®—å½“å‰å›¾ç‰‡å’ŒåŸºçº¿å›¾ç‰‡çš„å“ˆå¸Œå€¼
3. å¦‚æœå“ˆå¸Œå€¼ç›¸åŒï¼Œæµ‹è¯•é€šè¿‡
4. å¦‚æœå“ˆå¸Œå€¼ä¸åŒï¼Œè¿›è¡Œåƒç´ çº§æ¯”è¾ƒ
5. å¦‚æœå·®å¼‚åœ¨å®¹å·®èŒƒå›´å†…ï¼Œæµ‹è¯•é€šè¿‡
6. å¦åˆ™æµ‹è¯•å¤±è´¥ï¼Œç”Ÿæˆå·®å¼‚å›¾ç‰‡

### å·®å¼‚åˆ†æ
- **å·®å¼‚ â‰¤ å®¹å·®**: âœ… æµ‹è¯•é€šè¿‡
- **å·®å¼‚ > å®¹å·®**: âŒ æµ‹è¯•å¤±è´¥ï¼Œç”Ÿæˆå·®å¼‚å›¾ç‰‡
- **å“ˆå¸Œå€¼ç›¸åŒ**: âœ… å®Œå…¨ä¸€è‡´ï¼Œè·³è¿‡åƒç´ å¯¹æ¯”

## ğŸ¨ æµ‹è¯•é¡¹ç›®è¦†ç›–

### è¥é”€æµ·æŠ¥é¡¹ç›® (10ä¸ª)
| é¡¹ç›® | åè®®æ–‡ä»¶ | æè¿° |
|------|----------|------|
| trip | `projects/trip/trip_protocol.json` | é’æµ·æ¹–æ—…æ¸¸æ”»ç•¥ |
| sunscreen | `projects/sunscreen/sunscreen_protocol.json` | é˜²æ™’æµ·æŠ¥ |
| food | `projects/food/food_protocol.json` | ç¾é£Ÿæµ·æŠ¥ |
| spring | `projects/spring/spring_protocol.json` | æ˜¥å¤©æµ·æŠ¥ |
| dessert | `projects/dessert/dessert_protocol.json` | ç”œå“æµ·æŠ¥ |
| cup | `projects/cup/cup_protocol.json` | æ¯å­æµ·æŠ¥ |
| horizontal | `projects/horizontal/horizontal_protocol.json` | å†¬è‡³æµ·æŠ¥ |
| long | `projects/long/long_protocol.json` | è›‹é»„å¿ƒé•¿å›¾ |
| clothes | `projects/clothes/clothes_protocol.json` | æœè£…æµ·æŠ¥ |
| tshirt | `projects/tshirt/tshirt_protocol.json` | Tæ¤æµ·æŠ¥ |

### æ–‡æœ¬æ¸²æŸ“æ¨¡å¼æµ‹è¯• (4ä¸ª)
| é¡¹ç›® | åè®®æ–‡ä»¶ | æè¿° |
|------|----------|------|
| single_line | `projects/text_wrap_test/single_line_protocol.json` | å•è¡Œæ¨¡å¼ + çœç•¥å· |
| multi_line | `projects/text_wrap_test/multi_line_protocol.json` | å¤šè¡Œæ¨¡å¼ + è¡Œæ•°é™åˆ¶ |
| word_wrap | `projects/text_wrap_test/word_wrap_protocol.json` | è‡ªåŠ¨æ¢è¡Œæ¨¡å¼ |
| auto_fit | `projects/text_wrap_test/auto_fit_protocol.json` | è‡ªé€‚åº”å­—ä½“ç¼©æ”¾ |

## âš™ï¸ æŠ€æœ¯å®ç°

### 1. æ¸²æŸ“é˜¶æ®µ
```bash
./build/renderer projects/trip/trip_protocol.json
# è¾“å‡º: output/trip_rendered.png
```

### 2. å›¾ç‰‡æŸ¥æ‰¾
```cpp
// åœ¨ output/ ç›®å½•æŸ¥æ‰¾åŒ…å«é¡¹ç›®åçš„PNGæ–‡ä»¶
for (const auto& entry : fs::directory_iterator(outputDir)) {
    if (entry.is_regular_file() && entry.path().extension() == ".png") {
        std::string filename = entry.path().filename().string();
        if (filename.find(testName) != std::string::npos) {
            currentImagePath = entry.path().string();
            break;
        }
    }
}
```

### 3. å“ˆå¸Œå€¼å¯¹æ¯”
```cpp
// å¿«é€Ÿå“ˆå¸Œå€¼æ¯”è¾ƒ
std::string currentHash = calculateImageHash(currentImagePath);
std::string baselineHash = calculateImageHash(baselineImagePath);

if (currentHash == baselineHash) {
    return true; // å®Œå…¨ä¸€è‡´
}
```

### 4. åƒç´ çº§åˆ†æ
```cpp
// ç²¾ç¡®åƒç´ æ¯”è¾ƒ
double difference = compareImages(currentImagePath, baselineImagePath);
if (difference <= tolerance) {
    return true; // åœ¨å®¹å·®èŒƒå›´å†…
}

// ç”Ÿæˆå·®å¼‚å›¾ç‰‡
generateDifferenceImage(currentImagePath, baselineImagePath, diffImagePath);
```

## ğŸ“‹ æœ€ä½³å®è·µ

### 1. å¼€å‘æµç¨‹
```bash
# æ¯æ¬¡ä»£ç ä¿®æ”¹åè¿è¡Œæµ‹è¯•
./run_simple_test.sh

# ç¡®è®¤æ–°ç»“æœæ­£ç¡®åæ›´æ–°åŸºçº¿
./build/simple_test update <project_name>
```

### 2. å®¹å·®è®¾ç½®å»ºè®®
- **å¾®å°è°ƒæ•´**: 0.1% - 0.5% (å­—ä½“å¾®è°ƒã€é¢œè‰²ç»†è°ƒ)
- **ä¸­ç­‰æ”¹åŠ¨**: 0.5% - 1% (å¸ƒå±€è°ƒæ•´ã€æ ·å¼ä¼˜åŒ–)  
- **å¤§å¹…æ”¹åŠ¨**: 1% - 2% (é‡æ„æ¸²æŸ“é€»è¾‘ã€æ–°åŠŸèƒ½)

### 3. å·®å¼‚åˆ†æ
- æŸ¥çœ‹ `tests/diff/` ç›®å½•ä¸­çš„å·®å¼‚å›¾ç‰‡
- çº¢è‰²åƒç´ è¡¨ç¤ºå·®å¼‚ä½ç½®
- åˆ†æå·®å¼‚æ˜¯å¦ä¸ºé¢„æœŸå˜åŒ–
- ç¡®è®¤åŠŸèƒ½æ­£ç¡®æ€§åæ›´æ–°åŸºçº¿

### 4. ä¸€è‡´æ€§ä¿è¯
```bash
# å…³é”®é¡¹ç›®å¤šæ¬¡éªŒè¯
./build/simple_test consistency auto_fit 10
./build/simple_test consistency word_wrap 5
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. ç¼–è¯‘é”™è¯¯
```bash
# é‡æ–°ç¼–è¯‘é¡¹ç›®
./build.sh --debug

# æ£€æŸ¥ä¾èµ–
ls -la build/
```

#### 2. åŸºçº¿å›¾ç‰‡ç¼ºå¤±
```bash
# ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºåŸºçº¿ï¼Œé¦–æ¬¡è¿è¡Œæ­£å¸¸
./build/simple_test run
```

#### 3. å·®å¼‚è¿‡å¤§
- æ£€æŸ¥æœ€è¿‘çš„ä»£ç ä¿®æ”¹
- ç¡®è®¤å­—ä½“æ–‡ä»¶å’Œèµ„æºæ–‡ä»¶æœªå˜åŒ–
- è°ƒæ•´å®¹å·®è®¾ç½®æˆ–æ›´æ–°åŸºçº¿

#### 4. ä¸€è‡´æ€§æµ‹è¯•å¤±è´¥
- æ£€æŸ¥éšæœºæ•°ç”Ÿæˆé€»è¾‘
- ç¡®è®¤æ—¶é—´ç›¸å…³ä»£ç 
- éªŒè¯å¤–éƒ¨ä¾èµ–çš„ç¡®å®šæ€§

### è°ƒè¯•æŠ€å·§

#### 1. å•é¡¹è°ƒè¯•
```bash
# è¿è¡Œå•ä¸ªæµ‹è¯•é¡¹ç›®
./build/renderer projects/auto_fit/auto_fit_protocol.json

# æ£€æŸ¥è¾“å‡ºå›¾ç‰‡
open output/auto_fit_poster.png
```

#### 2. è¯¦ç»†è¾“å‡º
```bash
# Debugæ¨¡å¼åŒ…å«è¯¦ç»†æ—¥å¿—
./build.sh --debug
./build/simple_test consistency trip 1
```

#### 3. æ–‡ä»¶æ£€æŸ¥
```bash
# æŸ¥çœ‹å„ç›®å½•æ–‡ä»¶
ls -la output/           # å½“å‰è¾“å‡º
ls -la tests/baseline/   # åŸºçº¿å›¾ç‰‡  
ls -la tests/diff/       # å·®å¼‚å›¾ç‰‡
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### ç®—æ³•ä¼˜åŒ–
1. **å“ˆå¸Œä¼˜å…ˆ**: ä¼˜å…ˆä½¿ç”¨å“ˆå¸Œå€¼è¿›è¡Œå¿«é€Ÿæ¯”è¾ƒ
2. **åƒç´ é‡‡æ ·**: å¯¹äºè¶…å¤§å›¾ç‰‡ï¼Œå¯ä»¥é‡‡æ ·æ¯”è¾ƒ
3. **å¹¶è¡Œå¤„ç†**: å¤šä¸ªæµ‹è¯•é¡¹ç›®å¯ä»¥å¹¶è¡Œæ‰§è¡Œ
4. **ç¼“å­˜æœºåˆ¶**: ç¼“å­˜å·²è®¡ç®—çš„å“ˆå¸Œå€¼

### èµ„æºç®¡ç†
- å¤§å›¾ç‰‡å¤„ç†æ—¶æ³¨æ„å†…å­˜ä½¿ç”¨
- å·®å¼‚å›¾ç‰‡ç”Ÿæˆéœ€è¦é¢å¤–å†…å­˜
- å»ºè®®åˆ†æ‰¹å¤„ç†å¤§é‡æµ‹è¯•é¡¹ç›®
- å®šæœŸæ¸…ç†ä¸´æ—¶æ–‡ä»¶

## ğŸ”® æ‰©å±•å¼€å‘

### æ·»åŠ æ–°æµ‹è¯•é¡¹ç›®
1. åœ¨å¯¹åº”é¡¹ç›®ç›®å½•æ·»åŠ åè®®æ–‡ä»¶
2. ä¿®æ”¹ `tests/simple_image_test.cpp` ä¸­çš„æµ‹è¯•åˆ—è¡¨
3. é‡æ–°ç¼–è¯‘å¹¶è¿è¡Œæµ‹è¯•

### è‡ªå®šä¹‰å¯¹æ¯”ç®—æ³•
- ä¿®æ”¹ `compareImages()` å‡½æ•°
- æ·»åŠ æ–°çš„å·®å¼‚è®¡ç®—æ–¹æ³•
- æ”¯æŒä¸åŒç±»å‹çš„å›¾ç‰‡æ ¼å¼

### é›†æˆCI/CD
```yaml
# GitHub Actions ç¤ºä¾‹
- name: Run Tests
  run: |
    ./build.sh --release
    ./run_simple_test.sh
```

---

**ç¡®ä¿æ¸²æŸ“è´¨é‡ï¼Œç»´æŠ¤ä»£ç ç¨³å®šæ€§ï¼** ğŸ¨âœ¨ 